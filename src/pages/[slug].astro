---
import Base from "../layouts/Base.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

// ðŸš€ Báº®T BUá»˜C cho SSG: liá»‡t kÃª táº¥t cáº£ cÃ¡c slug cáº§n build
export async function getStaticPaths() {
  const res = await fetch("https://meolamdep.info/wp-json/wp/v2/posts?_fields=slug&per_page=100");
  const posts = await res.json();

  // Astro sáº½ build trÆ°á»›c táº¥t cáº£ cÃ¡c slug nÃ y
  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
}

// âœ… Láº¥y chi tiáº¿t bÃ i viáº¿t
const { slug } = Astro.params;
const res = await fetch(`https://meolamdep.info/wp-json/wp/v2/posts?_embed&slug=${slug}`);
const [post] = await res.json();
if (!post) throw new Error(`Post not found: ${slug}`);
---

<Base title={post.title.rendered} description={post.excerpt.rendered}>
  <Fragment slot="header"><Header /></Fragment>

  <article class="container mx-auto max-w-3xl px-4 py-8 prose prose-pink">
    <h1 set:html={post.title.rendered}></h1>
    <div set:html={post.content.rendered}></div>
  </article>

  <Fragment slot="footer"><Footer /></Fragment>
</Base>
