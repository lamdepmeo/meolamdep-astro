---
import Layout from "../layouts/Layout.astro";

// ⚙️ Hàm này sẽ gọi API để lấy toàn bộ category từ WordPress
export async function getStaticPaths() {
  const res = await fetch("https://meolamdep.info/wp-json/wp/v2/categories?per_page=100");
  const categories = await res.json();

  // Trả về danh sách slug để Astro biết cần build những trang nào
  return categories.map((cat) => ({
    params: { category: cat.slug },
    props: { cat },
  }));
}

// ⚙️ Sau đó bạn có thể fetch bài viết thuộc category đó:
const { category } = Astro.params;
const res = await fetch(`https://meolamdep.info/wp-json/wp/v2/posts?categories=${Astro.props.cat.id}&per_page=10`);
const posts = await res.json();
---

<Layout title={Astro.props.cat.name}>
  <section class="container">
    <h1>{Astro.props.cat.name}</h1>
    <div class="grid grid-cols-2 gap-6">
      {posts.map((post) => (
        <article class="card">
          <img src={post.jetpack_featured_media_url} alt={post.title.rendered} />
          <h2 set:html={post.title.rendered}></h2>
          <a href={`/${post.slug}/`}>Đọc thêm</a>
        </article>
      ))}
    </div>
  </section>
</Layout>
